<extend name='Admin@Public:form' />

<block name="content">
    <div class="form-group">
        <label class="col-sm-2 control-label tr">活动类型 <b class="required">*</b></label>
        <div class="col-sm-9">
            <select name="type" class="form-control ui-select2" title="请选择活动类型" <notempty name="vo.type">disabled</notempty> required>
                <option value="1" <eq name="vo.type" value="1">selected</eq>>大转盘</option>
                <option value="2" <eq name="vo.type" value="2">selected</eq>>砸金蛋</option>
                <option value="3" <eq name="vo.type" value="3">selected</eq>>开宝箱</option>
            </select>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label tr">活动主题 <b class="required">*</b></label>
        <div class="col-sm-9">
            <input required="" value="{$vo.title}" maxlength="30" pattern="^.{2,30}$" title="活动主题请输入2-30个字符" type="text" name="title" class="form-control" placeholder="请输入活动主题">
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label tr">参与所需积分 <b class="required">*</b></label>
        <div class="col-sm-9">
            <input required="" value="{$vo.jifen}" maxlength="10" onkeyup="this.value = this.value.replace(/[^\d|.]/g, '')" pattern="^[.0-9]{0,10}$" title="所需积分请输入少于10位数字"  type="text" name="jifen" class="form-control" placeholder="请输入单次抽奖所需积分">
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label tr">抽奖次数 <b class="required">*</b></label>
        <div class="col-sm-9">
            <input required="" value="{$vo.aginfo}" maxlength="2" onkeyup="this.value = this.value.replace(/[^\d|.]/g, '')" pattern="^[.0-9]{0,10}$" title="请输入0-99的数"  type="text" name="aginfo" class="form-control" placeholder="允许用户每天参与抽奖活动的次数，为0时不限制次数">
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label tr">一等奖 <b class="required">*</b></label>
        <div class="col-sm-9">
            <select name="fistid" class="form-control ui-select2" title="请选择奖品" required>
                <option value="">请选择奖品</option>
                <volist name="awardslist" id="list">
                    <option value="{$list.id}" <eq name="vo.fistid" value="$list.id">selected</eq> >{$list.name} &nbsp; &nbsp;库存：{$list.nums}</option>
                </volist>
            </select>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label tr">奖品数量</label>
        <div class="col-sm-9">
            <input value="{$vo.fistnums}" type="text" maxlength="10" onkeyup="this.value = this.value.replace(/[^\d|.]/g, '')" name="fistnums" pattern="^[.0-9]{0,10}$" title="奖品数量请输入少于10位数字" class="form-control" placeholder="请输入奖品数量">
        </div>
    </div>

    <div class="form-group">
        <label class="col-sm-2 control-label tr">二等奖 </label>
        <div class="col-sm-9">
            <select name="secondid" class="form-control ui-select2" title="请选择奖品">
                <option value="">请选择奖品</option>
                <volist name="awardslist" id="list">
                    <option value="{$list.id}" <eq name="vo.secondid" value="$list.id">selected</eq> >{$list.name} &nbsp; &nbsp;库存：{$list.nums}</option>
                </volist>
            </select>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label tr">奖品数量</label>
        <div class="col-sm-9">
            <input value="{$vo.secondnums}" type="text" name="secondnums" maxlength="10" onkeyup="this.value = this.value.replace(/[^\d|.]/g, '')" pattern="^[.0-9]{0,10}$" title="奖品数量请输入少于10位数字" class="form-control" placeholder="请输入奖品数量">
        </div>
    </div>

    <div class="form-group">
        <label class="col-sm-2 control-label tr">三等奖 </label>
        <div class="col-sm-9">
            <select name="thirdid" class="form-control ui-select2" title="请选择奖品">
                <option value="">请选择奖品</option>
                <volist name="awardslist" id="list">
                    <option value="{$list.id}" <eq name="vo.thirdid" value="$list.id">selected</eq> >{$list.name} &nbsp; &nbsp;库存：{$list.nums}</option>
                </volist>
            </select>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label tr">奖品数量</label>
        <div class="col-sm-9">
            <input value="{$vo.thirdnums}" type="text" name="thirdnums" maxlength="10" onkeyup="this.value = this.value.replace(/[^\d|.]/g, '')" pattern="^[.0-9]{0,10}$" title="奖品数量请输入少于10位数字" class="form-control" placeholder="请输入奖品数量">
        </div>
    </div>

    <div class="form-group">
        <label class="col-sm-2 control-label tr">四等奖 </label>
        <div class="col-sm-9">
            <select name="fourid" class="form-control ui-select2" title="请选择奖品">
                <option value="">请选择奖品</option>
                <volist name="awardslist" id="list">
                    <option value="{$list.id}" <eq name="vo.fourid" value="$list.id">selected</eq> >{$list.name} &nbsp; &nbsp;库存：{$list.nums}</option>
                </volist>
            </select>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label tr">奖品数量</label>
        <div class="col-sm-9">
            <input value="{$vo.fournums}" type="text" name="fournums" maxlength="10" onkeyup="this.value = this.value.replace(/[^\d|.]/g, '')" pattern="^[.0-9]{0,10}$" title="奖品数量请输入少于10位数字" class="form-control" placeholder="请输入奖品数量">
        </div>
    </div>

    <div class="form-group">
        <label class="col-sm-2 control-label tr">五等奖 </label>
        <div class="col-sm-9">
            <select name="fiveid" class="form-control ui-select2" title="请选择奖品">
                <option value="">请选择奖品</option>
                <volist name="awardslist" id="list">
                    <option value="{$list.id}" <eq name="vo.fiveid" value="$list.id">selected</eq> >{$list.name} &nbsp; &nbsp;库存：{$list.nums}</option>
                </volist>
            </select>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label tr">奖品数量</label>
        <div class="col-sm-9">
            <input value="{$vo.fivenums}" type="text" name="fivenums" maxlength="10" onkeyup="this.value = this.value.replace(/[^\d|.]/g, '')" pattern="^[.0-9]{0,10}$" title="奖品数量请输入少于10位数字" class="form-control" placeholder="请输入奖品数量">
        </div>
    </div>

    <div class="form-group">
        <label class="col-sm-2 control-label tr">六等奖 </label>
        <div class="col-sm-9">
            <select name="sixid" class="form-control ui-select2" title="请选择奖品">
                <option value="">请选择奖品</option>
                <volist name="awardslist" id="list">
                    <option value="{$list.id}" <eq name="vo.sixid" value="$list.id">selected</eq> >{$list.name} &nbsp; &nbsp;库存：{$list.nums}</option>
                </volist>
            </select>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label tr">奖品数量</label>
        <div class="col-sm-9">
            <input value="{$vo.sixnums}" type="text" name="sixnums" maxlength="10" onkeyup="this.value = this.value.replace(/[^\d|.]/g, '')" pattern="^[.0-9]{0,10}$" title="奖品数量请输入少于10位数字" class="form-control" placeholder="请输入奖品数量">
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label tr">抽奖模式 <b class="required">*</b></label>
        <div class="col-sm-9">
            <div class="form-control">
                <label><input value="2" type="radio" name="crazy" class="ace" <eq name="vo.crazy" value="2">checked</eq>><span class="lbl">100%中奖模式</span></label>
                <label><input value="1" type="radio" name="crazy" class="ace" <neq name="vo.crazy" value="2">checked</neq>><span class="lbl">概率模式</span></label>
            </div>
        </div>
        <label class="col-sm-2 control-label tr red">模式说明 </label>
        <div class="col-sm-9">
            <span class="red">▲注意：100%中奖模式下就算购买积分不达限制也会中奖，且只会抽中最低的奖项；概率模式如下：请填写大于等于默认值的数值</span>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label tr">中奖率 <b class="required">*</b></label>
        <div class="col-sm-9">
            <input value="{$vo['maxpoint']||0}" maxlength="10" onkeyup="this.value = this.value.replace(/[^\d|.]/g, '')" pattern="^[0-9]{0,10}$" title="中奖率请输入少于10位数字"  type="text" name="maxpoint" class="form-control" placeholder="请设置中奖率">
        </div>
        <label class="col-sm-2 control-label tr red">中奖率说明 </label>
        <div class="col-sm-9">
            <span class="red">如:设置一等奖1名，当中奖率设10000时一等奖为中奖率1/10000;当奖品数量之和等于中奖率时，用户100%中奖;各奖项中奖率按设置奖品数量所占比来计算,超出部分不中奖。</span>
        </div>
    </div>
        <div class="form-group">
        <label class="col-sm-2 control-label tr">限制奖项 <b class="required">*</b></label>
        <div class="col-sm-9">
            <select name="lmt" class="form-control ui-select2" title="请选择大奖限制奖项">
                <option value="" <empty name="vo.lmt">selected</empty> >不限制</option>
                <option value="1" <eq name="vo.lmt" value="1">selected</eq> >限制一等奖</option>
                <option value="2" <eq name="vo.lmt" value="2">selected</eq> >限制二等奖及以上</option>
                <option value="3" <eq name="vo.lmt" value="3">selected</eq> >限制三等奖及以上</option>
                <option value="4" <eq name="vo.lmt" value="4">selected</eq> >限制四等奖及以上</option>
                <option value="5" <eq name="vo.lmt" value="5">selected</eq> >限制五等奖及以上</option>
                <option value="6" <eq name="vo.lmt" value="6">selected</eq> >限制全部奖项</option>
            </select>
        </div>
        <label class="col-sm-2 control-label tr red">限制奖项说明 </label>
        <div class="col-sm-9">
            <span class="red">达到限制积分的要求才能抽中被限制的奖项</span>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label tr">限制积分 <b class="required">*</b></label>
        <div class="col-sm-9">
            <input required="" value="{$vo.need}" maxlength="10" pattern="^[.0-9]{0,10}$" onkeyup="this.value = this.value.replace(/[^\d|.]/g, '')" title="限制积分请输入少于10位数字" type="text" name="need" class="form-control" placeholder="请输入大奖所需积分">
        </div>
        <label class="col-sm-2 control-label tr red">限制积分说明 </label>
        <div class="col-sm-9">
            <span class="red">限制积分为购买积分</span>
        </div>
    </div>
        <div class="form-group">
        <label class="col-sm-2 control-label tr">备注/状况 <b class="required">*</b></label>
        <div class="col-sm-9">
            <textarea class="form-control"  name="info">{$vo.info}</textarea>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label tr">抽奖规则 <b class="required">*</b></label>
        <div class="col-sm-9">
            <textarea class="form-control h120" name="rule">{$vo.rule}</textarea>
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label tr">开始时间 <b class="required">*</b></label>
        <div class="col-sm-9">
            <input value="{$vo.statdate}" type="text" data-datepicker name="statdate" class="form-control" placeholder="请输入起始日期">
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label tr">结束时间 <b class="required">*</b></label>
        <div class="col-sm-9">
            <input value="{$vo.enddate}" type="text" data-datepicker name="enddate" class="form-control" placeholder="请输入结束日期">
        </div>
    </div>
    <div class="form-group">
        <label class="col-sm-2 control-label tr">活动状态 </label>
        <div class="col-sm-9">
            <div class="form-control">
                <label><input value="2" type="radio" name="status" class="ace" <neq name="vo.status" value="1">checked</neq>><span class="lbl">启用</span></label>
                <label><input value="1" type="radio" name="status" class="ace" <eq name="vo.status" value="1">checked</eq>><span class="lbl">禁用</span></label>
            </div>
        </div>
    </div>
    <notempty name="vo">
        <input type="hidden" value="{$vo.id|default=0}" name="id"/>
    </notempty>
</block>
<block name="style">
    <style>
        .h120{height: 120px!important;}
    </style>
</block>
<block name="script">
    <script>
        $(function () {
            $("input[name=maxpoint]").focusout(function () {
                var maxp = parseInt($(this).val());
                var sum = 0;
                var num1 = parseInt($("input[name=fistnums]").val());
                var num2 = parseInt($("input[name=secondnums]").val());
                var num3 = parseInt($("input[name=thirdnums]").val());
                var num4 = parseInt($("input[name=fournums]").val());
                var num5 = parseInt($("input[name=fivenums]").val());
                var num6 = parseInt($("input[name=sixnums]").val());
                sum = num1 + num2 + num3 + num4 + num5 + num6;
                if (maxp < sum || maxp === 0) {
                    $(this).val(sum).focus();
                    $.msg.show("中奖率不能小于奖品数量之和", false, 2, "info");
                }
            });
            $("input[name=crazy]").click(function () {
                var crazy = parseInt($(this).val());
//                console.log(crazy);
                if (crazy === 1) {
                    $("input[name=maxpoint]").removeAttr('disabled');
                    var maxp = parseInt($("input[name=maxpoint]").val());
                    var sum = 0;
                    var num1 = parseInt($("input[name=fistnums]").val());
                    var num2 = parseInt($("input[name=secondnums]").val());
                    var num3 = parseInt($("input[name=thirdnums]").val());
                    var num4 = parseInt($("input[name=fournums]").val());
                    var num5 = parseInt($("input[name=fivenums]").val());
                    var num6 = parseInt($("input[name=sixnums]").val());
                    sum = num1 + num2 + num3 + num4 + num5 + num6;
                    if (maxp < sum || maxp === 0) {
                        $("input[name=maxpoint]").val(sum).focus();
                    }
                } else {
                    $("input[name=maxpoint]").attr('disabled', 'disabled');
                }
            });
        });
    </script>
</block>